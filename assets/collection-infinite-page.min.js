(()=>{var m=function(){let e=document.getElementById("grid_style_list");if(!e)return;let{container:s}=this,i=[...s.classList].join(" "),{productGridContainer:o}=this.elms;e.children.forEach(t=>{let n=t.dataset.class,r=t.dataset.style;t.addEvent("click",()=>{o.className=n,s.className=`${i} ${r}`})})};function p(){let{sidebarContainer:e}=this.elms;if(!e)return;let s=e.querySelectorAll(".featured_block-filter_group"),i=this.elms.sidebarContainer.dataset.filterType;function o(){theme.settings.collection.scrollTopWhenFilter&&AT.scrollTo(document.getElementById("main-layout").offsetTop-100)}s.forEach(t=>{let n=t.dataset.multiple==="true",r=t.querySelector(".filter-clear"),a=t.querySelectorAll(".tags-link"),h;a.forEach(c=>{let d=c.dataset.tagValue;c.addEvent("click",u=>{u.preventDefault(),c.hasClass("active")?(this.currentTags=this.currentTags.filter(l=>l!=d),h="remove"):(!n&&i!="attribute"&&[...a].filter(l=>l.hasClass("active")).forEach(l=>(l.removeClass("active"),this.currentTags=this.currentTags.filter(C=>C!=l.dataset.tagValue))),this.currentTags.push(d),h="add"),r.addClass("pending"),r.removeClass("d-none"),this.getProductList(this.getUrlAjaxRequest(null,"filter",c)).then(()=>{switch(h){case"add":c.addClass("active");break;case"remove":c.removeClass("active"),[...a].find(l=>l.hasClass("active"))||r.addClass("d-none");break}r.removeClass("pending"),o()})})}),r?.addEvent("click",c=>{c.preventDefault();let d=[...a].map(l=>l.hasClass("active")&&l.dataset.tagValue).filter(Boolean);this.currentTags=this.currentTags.filter(l=>!d.includes(l)),r.addClass("pending");let u;i=="attribute"?u=r.href:u=this.getUrlAjaxRequest(null,"filter"),this.getProductList(u).then(()=>{r.addClass("d-none"),r.removeClass("pending"),a.forEach(l=>l.removeClass("active")),o()})})}),e.querySelector(".js-filter-form")?.addEventListener("submit",t=>{t.preventDefault();let n=new FormData(t.target),r=new URLSearchParams(n).toString(),a=document.createElement("a");a.href=`${t.target.action}?${r}`,this.getProductList(this.getUrlAjaxRequest(null,"filter",a))})}var f={onLoad:function(){let{container:e}=this;Object.assign(this,theme.collection),!this.currentTags&&(this.currentTags=[]),this.elms={sortContainer:e.querySelector(".js-collection-sort-container"),selectDesk:document.getElementById("select_desk"),selectDeskTitle:document.getElementById("select_desk_title"),selectDeskContainer:document.getElementById("select_desk_container"),productItems:[...e.getElementsByClassName("product-section")],infiniteBtn:e.querySelector(".js-infinite-btn"),productGridContainer:e.querySelector("#product-grid-container"),sidebarContainer:e.querySelector("#sidebarDrawer"),toggleSbButton:e.getElementsByClassName("js-toggle-sb"),infiniteButton:e.querySelector(".js-infinite-btn"),filterContainer:document.querySelector(".js-filter-container")},this.initSortCollection(),this.initCollapse(),p.call(this),this.initToggleSidebar(),this.initFilter(),this.initInfinite(),m.call(this)},initFilter(){let{filterContainer:e}=this.elms;!e||(typeof Filter!="undefined"?new Filter(e):AT.loadCollectionFilter().then(()=>{new Filter(e)}))},initSortCollection:function(){let{sortContainer:e}=this.elms,s=e.querySelector("#select_desk_container"),i=e.querySelector("#select_desk"),o=s.querySelector("#select_desk_title"),n=e.querySelector("#mobile-select-container").firstElementChild;s.addEvent("click",function(){this.hasClass("is-open")?this.removeClass("is-open"):this.addClass("is-open")}),document.addEvent("click",r=>{s.contains(r.target)||s.removeClass("is-open")}),i.children.addEvents("click",function(){let r=this.innerHTML,a=this.dataset.value;o.innerHTML=r,n.value=a,n.dispatchEvent(new Event("change"))}),n.addEvent("change",r=>{let{value:a}=r.target;this.getProductList(this.getUrlAjaxRequest(a,"sort-by"))})},getUrlAjaxRequest:function(e,s){let i="",o;switch(window.location.href.includes("vendors")&&(o=AT.getParameterByName("q")),s){case"sort-by":{if(o){let t=[...window.location.search.replace("?","").split("&").filter(n=>!n.includes("sort_by")),`sort_by=${e}`,"view=ajax-request"];i=`${window.location.pathname}?${t.join("&")}`}else if(window.location.search)if(location.search.includes("sort_by")){let t=location.search.split("&");t=t.map(n=>n.includes("sort_by")?n.split("=")[0]+"="+e:n),t.push("view=ajax-request"),i=`${location.origin}${location.pathname}${t.join("&")}`}else i=`${location.href}&sort_by=${e}&view=ajax-request`;else i=`${location.href}?sort_by=${e}&view=ajax-request`;break}case"filter":{if(o){let t=[this.currentTags.length?`constraint=${encodeURIComponent(this.currentTags.join("+"))}`:"",...window.location.search.replace("?","").split("&").filter(n=>!n.includes("constraint")&&!n.includes("page")),"view=ajax-request"].filter(Boolean).join("&");i=`${window.location.pathname}?${t}`}else if(location.search){let t=location.search.split("&");t=t.map(n=>n.includes("page=")&&+n.split("=")[1]>1?n.split("=")[0]+"=1":n),i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${t.join("&")}&view=ajax-request`,console.log(121233)}else console.log(123),i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}default:window.location.search?i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${window.location.search}&view=ajax-request`:i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}return i},getProductList:function(e){let{productGridContainer:s,infiniteButton:i}=this.elms;return fetch(e,{dataType:"text"}).then(o=>{let t=document.createElement("div");t.innerHTML=o;let n=t.querySelectorAll(".js-product-card");n.length?(s.innerHTML="",n.forEach(r=>{ProductCard.initEvent(r),s.append(r)})):s.innerHTML=`<p class="text-center">${this.notFound}</p>`,history.replaceState({},"",e.replace("?view=ajax-request&","?").replace("?view=ajax-request","").replace("&view=ajax-request","")),typeof window.SPR!="undefined"&&(window.SPR.initDomEls(),window.SPR.loadBadges(),window.SPR.loadProducts()),document.title=t.querySelector(".page-title").textContent,i.setAttribute("data-page",1),i.removeClass("end")})},initCollapse:function(){this.container.getElementsByClassName("js-btn-collapse").addEvents("click",function(){this.hasClass("is-open")?(this.removeClass("is-open"),this.nextElementSibling.removeClass("is-open")):(this.addClass("is-open"),this.nextElementSibling.addClass("is-open"))})},initToggleSidebar:function(){let{toggleSbButton:e,sidebarContainer:s}=this.elms;!s||e.forEach(i=>{i.addEvent("click",function(){let{role:o}=i.dataset;switch(o){case"open":s.addClass("is-open");break;case"close":s.removeClass("is-open");break}})})},initInfinite:function(){let{infiniteButton:e,productGridContainer:s}=this.elms,i=!1,o=()=>{if(i||e.hasClass("end"))return;let t=e.getBoundingClientRect();if(500>t.top-window.innerHeight){let r=+e.dataset.page+1,a=this.getUrlAjaxRequest()+`&page=${r}`;i=!0,e.addClass("pending"),fetch(a,{dataType:"text"}).then(h=>{let c=document.createElement("div");c.innerHTML=h;let d=c.querySelectorAll(".js-product-card"),u=c.querySelector(".last-page");d.length&&(d.forEach(l=>{ProductCard.initEvent(l),s.append(l)}),e.setAttribute("data-page",r)),i=!1,e.removeClass("pending"),u&&e.addClass("end"),typeof window.SPR!="undefined"&&(window.SPR.initDomEls(),window.SPR.loadBadges(),window.SPR.loadProducts())})}};window.removeEvent("scroll",o),window.addEvent("scroll",o)}};(()=>{register("collection-infinite",f),load("*"),console.log("collection-infinite-page.js loaded")})();})();
