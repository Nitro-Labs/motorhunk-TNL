(()=>{var m=function(){let t=document.getElementById("grid_style_list");if(!t)return;let{container:n}=this,r=[...n.classList].join(" "),{productGridContainer:i}=this.elms;t.children.forEach(a=>{let s=a.dataset.class,e=a.dataset.style;a.addEvent("click",()=>{i.className=s,n.className=`${r} ${e}`})})};function p(){let{sidebarContainer:t}=this.elms;if(!t)return;let n=t.querySelectorAll(".featured_block-filter_group"),r=this.elms.sidebarContainer.dataset.filterType;function i(){theme.settings.collection.scrollTopWhenFilter&&AT.scrollTo(document.getElementById("main-layout").offsetTop-100)}n.forEach(a=>{let s=a.dataset.multiple==="true",e=a.querySelector(".filter-clear"),l=a.querySelectorAll(".tags-link"),d;l.forEach(c=>{let h=c.dataset.tagValue;c.addEvent("click",u=>{u.preventDefault(),c.hasClass("active")?(this.currentTags=this.currentTags.filter(o=>o!=h),d="remove"):(!s&&r!="attribute"&&[...l].filter(o=>o.hasClass("active")).forEach(o=>(o.removeClass("active"),this.currentTags=this.currentTags.filter(C=>C!=o.dataset.tagValue))),this.currentTags.push(h),d="add"),e.addClass("pending"),e.removeClass("d-none"),this.getProductList(this.getUrlAjaxRequest(null,"filter",c)).then(()=>{switch(d){case"add":c.addClass("active");break;case"remove":c.removeClass("active"),[...l].find(o=>o.hasClass("active"))||e.addClass("d-none");break}e.removeClass("pending"),i()})})}),e?.addEvent("click",c=>{c.preventDefault();let h=[...l].map(o=>o.hasClass("active")&&o.dataset.tagValue).filter(Boolean);this.currentTags=this.currentTags.filter(o=>!h.includes(o)),e.addClass("pending");let u;r=="attribute"?u=e.href:u=this.getUrlAjaxRequest(null,"filter"),this.getProductList(u).then(()=>{e.addClass("d-none"),e.removeClass("pending"),l.forEach(o=>o.removeClass("active")),i()})})}),t.querySelector(".js-filter-form")?.addEventListener("submit",a=>{a.preventDefault();let s=new FormData(a.target),e=new URLSearchParams(s).toString(),l=document.createElement("a");l.href=`${a.target.action}?${e}`,this.getProductList(this.getUrlAjaxRequest(null,"filter",l))})}var f={onLoad:function(){let{container:t}=this;Object.assign(this,theme.collection),!this.currentTags&&(this.currentTags=[]),this.elms={sortContainer:t.querySelector(".js-collection-sort-container"),selectDesk:document.getElementById("select_desk"),selectDeskTitle:document.getElementById("select_desk_title"),selectDeskContainer:document.getElementById("select_desk_container"),productItems:[...t.getElementsByClassName("product-section")],infiniteBtn:t.querySelector(".js-infinite-btn"),productGridContainer:t.querySelector("#product-grid-container"),collectionPaginationContainer:t.querySelector(".js-colletion-pagination-container"),paginationShowing:t.querySelector(".js-pagination-showing"),sidebarContainer:t.querySelector("#sidebarDrawer"),toggleSbButton:t.getElementsByClassName("js-toggle-sb"),filterContainer:document.querySelector(".js-filter-container")},this.filterType=this.elms.sidebarContainer.dataset.filterType,this.initSortCollection(),this.initCollapse(),this.getProductList(this.getUrlAjaxRequest()),p.call(this),this.initToggleSidebar(),this.initFilter(),m.call(this)},initFilter(){let{filterContainer:t}=this.elms;!t||(typeof Filter!="undefined"?new Filter(t):AT.loadCollectionFilter().then(()=>{new Filter(t)}))},initSortCollection:function(){let{sortContainer:t}=this.elms,n=t.querySelector("#select_desk_container"),r=t.querySelector("#select_desk"),i=n.querySelector("#select_desk_title"),s=t.querySelector("#mobile-select-container").firstElementChild;n.addEvent("click",function(){this.hasClass("is-open")?this.removeClass("is-open"):this.addClass("is-open")}),document.addEvent("click",e=>{n.contains(e.target)||n.removeClass("is-open")}),r.children.addEvents("click",function(){let e=this.innerHTML,l=this.dataset.value;i.innerHTML=e,s.value=l,s.dispatchEvent(new Event("change"))}),s.addEvent("change",e=>{let{value:l}=e.target;this.getProductList(this.getUrlAjaxRequest(l,"sort-by"))})},getUrlAjaxRequest:function(t,n,r){let i="",a;switch(window.location.href.includes("vendors")&&(a=AT.getParameterByName("q")),n){case"sort-by":{if(a){let s=[...window.location.search.replace("?","").split("&").filter(e=>!e.includes("sort_by")),`sort_by=${t}`,"view=ajax-request"];i=`${window.location.pathname}?${s.join("&")}`}else if(window.location.search)if(location.search.includes("sort_by")){let s=location.search.split("&");s=s.map(e=>e.includes("sort_by")?e.split("=")[0]+"="+t:e),s.push("view=ajax-request"),i=`${location.origin}${location.pathname}${s.join("&")}`}else i=`${location.href}&sort_by=${t}&view=ajax-request`;else i=`${location.href}?sort_by=${t}&view=ajax-request`;break}case"filter":{if(this.filterType=="attribute"&&r)i=r.tagName=="A"?r.href:r.querySelector("a").href,i+="&view=ajax-request";else if(a){let s=[this.currentTags.length?`constraint=${encodeURIComponent(this.currentTags.join("+"))}`:"",...window.location.search.replace("?","").split("&").filter(e=>!e.includes("constraint")&&!e.includes("page")),"view=ajax-request"].filter(Boolean).join("&");i=`${window.location.pathname}?${s}`}else if(location.search){let s=location.search.split("&");s=s.map(e=>e.includes("page=")&&+e.split("=")[1]>1?e.split("=")[0]+"=1":e),i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${s.join("&")}&view=ajax-request`}else i=`${this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}default:window.location.search?i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}${window.location.search}&view=ajax-request`:i=`${this.url.includes("collections/vendors")?window.location.pathname:this.url}${this.currentTags.length?"/"+this.currentTags.join("+"):""}?view=ajax-request`;break}return i},getProductList:function(t){let{productGridContainer:n,collectionPaginationContainer:r,paginationShowing:i,sidebarContainer:a}=this.elms;return fetch(t,{dataType:"text"}).then(s=>{let e=document.createElement("div");e.innerHTML=s;let l=e.querySelectorAll(".js-product-card"),d=e.querySelector(".collection-pagination");i.innerHTML=e.querySelector(".pagination-showing").innerHTML,l.length?(n.innerHTML="",l.forEach(c=>{ProductCard.initEvent(c),n.append(c)})):n.innerHTML=`<p class="text-center">${this.notFound}</p>`,r.innerHTML=d.innerHTML||"",r.querySelectorAll("a").forEach(c=>{c.href=AT.removeParam("view",c.href)}),history.replaceState({},"",t.replaceAll("?view=ajax-request&","?").replaceAll("?view=ajax-request","").replaceAll("&view=ajax-request","")),this.replaceHref(e),this.updateFilterForm(e),document.title=e.querySelector(".page-title").textContent,typeof window.SPR!="undefined"&&(window.SPR.initDomEls(),window.SPR.loadBadges(),window.SPR.loadProducts())})},initCollapse:function(){this.container.getElementsByClassName("js-btn-collapse").addEvents("click",function(){this.hasClass("is-open")?(this.removeClass("is-open"),this.nextElementSibling.removeClass("is-open")):(this.addClass("is-open"),this.nextElementSibling.addClass("is-open"))})},initToggleSidebar:function(){let{toggleSbButton:t,sidebarContainer:n}=this.elms;!n||t.forEach(r=>{r.addEvent("click",function(){let{role:i}=r.dataset;switch(i){case"open":n.addClass("is-open");break;case"close":n.removeClass("is-open");break}})})},replaceHref:function(t){if(this.filterType!="attribute")return;let n=Array.from(this.elms.sidebarContainer.querySelectorAll(".js-filter-link"));t.querySelectorAll(".js-filter-link")?.forEach(r=>{let i=n.find(a=>a.dataset.filterId==r.dataset.filterId);i&&(i.href=r.href,i.setAttribute("data-active",r.dataset.active),i.closest(".tags-link")?.classList.toggle("active",i.dataset.active=="true"))})},updateFilterForm:function(t){t.querySelectorAll(".js-filter-update-content")?.forEach(n=>{let r=document.querySelector(`.js-filter-update-content[data-id="${n.dataset.id}"]`);r&&(r.innerHTML=n.innerHTML)})}};(()=>{register("collection-left-sidebar",f),load("*"),console.log("collection-left-siddebar-page.js loaded")})();})();
