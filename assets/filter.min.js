(()=>{var u=class{constructor(e){let t=e.dataset.urls;this.collectionPosition=+e.dataset.collectionPosition,this.elms={container:e,field1:e.querySelector(".chosen-container[data-field-index='1']"),field2:e.querySelector(".chosen-container[data-field-index='2']"),field3:e.querySelector(".chosen-container[data-field-index='3']"),buttonSubmit:e.querySelector(".js-btn-submit"),buttonReset:e.querySelector(".js-btn-reset")},this.getData(t).then(i=>{i=i.flat(2);let r=AT.cookie.get("arn-filter");if(!!r&&r instanceof Array){let[a,l,s]=r;if(!a||!l||!s){AT.cookie.delete("arn-filter"),this.initField(this.elms.field1,i);return}let o=i.find(d=>String(d.name).toLowerCase()==a.toLowerCase());if(!o){AT.cookie.delete("arn-filter"),this.initField(this.elms.field1,i);return}let n=o.field_2;if(o=n.find(d=>String(d.name).toLowerCase()==l.toLowerCase()),!o){AT.cookie.delete("arn-filter"),this.initField(this.elms.field1,i);return}let c=o.field_3;!!n&&!!c&&c.some(d=>String(d).toLowerCase()==s.toLowerCase())?(this.setField(this.elms.field1,a,i),this.setField(this.elms.field2,l,n),this.setField(this.elms.field3,s,c,!0)):(this.initField(this.elms.field1,i),AT.cookie.delete("arn-filter"))}else this.initField(this.elms.field1,i);this.initEventFieldTitle(),this.initEventButtonReset(),this.initEventButtonSubmit()})}initField(e,t,i){let r=i?t:t.map(n=>n.name),a=e.dataset.fieldIndex,l=e.querySelector(".js-title"),s=e.querySelector(".chosen-results"),o=e.querySelector(".chosen-drop");s.innerHTML="",r.forEach(n=>{let c=document.createElement("li");c.addClass("active-result"),c.innerHTML=String(n).toUpperCase(),c.setAttribute("data-value",n),s.append(c)}),s.children.addEvents("click",n=>{n.stopPropagation();let{target:c}=n,d=c.dataset.value;l.innerHTML=d,e.setAttribute("data-value",d),o.removeClass("active"),this.change(a,t,d)})}setField(e,t,i,r){this.initField(e,i,r),e.setAttribute("data-value",t),e.querySelector(".js-title").innerHTML=t.toUpperCase(),e.addClass("active")}change(e,t,i){let{field2:r,field3:a,buttonSubmit:l}=this.elms;switch(e){case"1":{let s=t.find(o=>String(o.name).toLowerCase()==i.toLowerCase()).field_2;this.resetField(r),this.resetField(a),this.initField(r,s),r.addClass("active"),r.querySelector(".chosen-drop").addClass("active");break}case"2":{let s=t.find(o=>String(o.name).toLowerCase()==i.toLowerCase()).field_3;this.resetField(a),this.initField(a,s,!0),a.addClass("active"),a.querySelector(".chosen-single").click();break}case"3":break}}resetField(e){let t=e.querySelector(".js-title");e.removeClass("active"),t.innerHTML=t.dataset.placeholder,e.setAttribute("data-value",""),e.querySelector(".chosen-results").innerHTMl=""}initEventFieldTitle(){let{container:e}=this.elms;e.querySelectorAll(".chosen-container").forEach(t=>{let i=t.querySelector(".chosen-single"),r=t.querySelector("input[name='search']"),a=t.querySelector(".chosen-results"),l=i.nextElementSibling;i.addEvent("click",()=>{l.hasClass("active")?l.removeClass("active"):l.addClass("active")}),document.addEvent("click",s=>{i.parentElement.contains(s.target)||l.removeClass("active")}),r.addEvent("input",()=>{let s=r.value.toLowerCase();a.children.forEach(o=>{o.innerHTML.toLowerCase().includes(s)?o.style.display="block":o.style.display="none"})})})}getData(e){return Promise.all(e.split(",").map(t=>fetch(t,{dataType:"json"})))}initEventButtonReset(){let{field1:e,field2:t,field3:i,buttonReset:r}=this.elms;r.addEvent("click",()=>{this.resetField(e),e.addClass("active"),this.resetField(t),this.resetField(i),AT.cookie.delete("arn-filter")})}initEventButtonSubmit(){let{buttonSubmit:e,field1:t,field2:i,field3:r}=this.elms;e.addEvent("click",a=>{let l=this.getOptionValues();if(l.filter(Boolean).length<3){switch(l.filter(Boolean).length){case 0:t.querySelector(".chosen-drop").addClass("active");break;case 1:i.querySelector(".chosen-drop").addClass("active");break;case 2:r.querySelector(".chosen-drop").addClass("active");break}a.stopPropagation();return}let s=this.getFilterUrl(l,e.dataset.filterType);AT.cookie.set("arn-filter",l,7),window.location.href=s})}getFilterUrl(e,t="tag"){if(t=="tag")return`${theme.routes.collectionsUrl}/${e[this.collectionPosition].convertToSlug()}/${e.map(l=>l.convertToSlug()).filter((l,s)=>this.collectionPosition!=s).join("+")}`;let{container:i}=this.elms,r=JSON.parse(i.querySelector('[name="filterAttribute"]').innerHTML),a=[theme.routes.collectionsUrl];return Object.values(r).forEach((l,s)=>{let o=l=="collections"?e[s].convertToSlug():`${l}=${e[s]}`;a.push(o)}),a.join("&").replace("&","/").replace("&","?")}getOptionValues(){let{field1:e,field2:t,field3:i}=this.elms;return[`${e.dataset.value}`,`${t.dataset.value}`,`${i.dataset.value}`]}};window.Filter=u;console.log("filter.js loaded");})();
