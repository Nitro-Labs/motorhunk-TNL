{
  "version": 3,
  "sources": ["../../app/scripts/filter.js"],
  "sourcesContent": ["class Filter {\n  constructor(container) {\n    let dataUrls = container.dataset.urls;\n    this.collectionPosition = +container.dataset.collectionPosition;\n    this.elms = {\n      container: container,\n      field1: container.querySelector(\".chosen-container[data-field-index='1']\"),\n      field2: container.querySelector(\".chosen-container[data-field-index='2']\"),\n      field3: container.querySelector(\".chosen-container[data-field-index='3']\"),\n      buttonSubmit: container.querySelector(\".js-btn-submit\"),\n      buttonReset: container.querySelector(\".js-btn-reset\"),\n    };\n    this.getData(dataUrls).then((data) => {\n      data = data.flat(2);\n      let lastSelect = AT.cookie.get(\"arn-filter\");\n      if (!!lastSelect && lastSelect instanceof Array) {\n        let [field1Value, field2Value, field3Value] = lastSelect;\n        if (!field1Value || !field2Value || !field3Value) {\n          AT.cookie.delete(\"arn-filter\");\n          this.initField(this.elms.field1, data);\n          return;\n        }\n        let temporaryVariable = data.find((item) => String(item.name).toLowerCase() == field1Value.toLowerCase());\n        if (!temporaryVariable) {\n          AT.cookie.delete(\"arn-filter\");\n          this.initField(this.elms.field1, data);\n          return;\n        }\n        let data2 = temporaryVariable[\"field_2\"];\n\n        temporaryVariable = data2.find((item) => String(item.name).toLowerCase() == field2Value.toLowerCase());\n        if (!temporaryVariable) {\n          AT.cookie.delete(\"arn-filter\");\n          this.initField(this.elms.field1, data);\n          return;\n        }\n        let data3 = temporaryVariable[\"field_3\"];\n        if (!!data2 && !!data3 && data3.some((a) => String(a).toLowerCase() == field3Value.toLowerCase())) {\n          this.setField(this.elms.field1, field1Value, data);\n          this.setField(this.elms.field2, field2Value, data2);\n          this.setField(this.elms.field3, field3Value, data3, true);\n        } else {\n          this.initField(this.elms.field1, data);\n          AT.cookie.delete(\"arn-filter\");\n        }\n      } else {\n        this.initField(this.elms.field1, data);\n      }\n      this.initEventFieldTitle();\n      this.initEventButtonReset();\n      this.initEventButtonSubmit();\n    });\n  }\n\n  initField(element, data, lastField) {\n    let newData = lastField ? data : data.map((item) => item.name);\n    let index = element.dataset.fieldIndex;\n    let titleElement = element.querySelector(\".js-title\");\n\n    let chosenResults = element.querySelector(\".chosen-results\");\n    let chosenDrop = element.querySelector(\".chosen-drop\");\n    chosenResults.innerHTML = \"\";\n    newData.forEach((item) => {\n      let li = document.createElement(\"li\");\n      li.addClass(\"active-result\");\n      li.innerHTML = String(item).toUpperCase();\n      li.setAttribute(\"data-value\", item);\n      chosenResults.append(li);\n    });\n\n    chosenResults.children.addEvents(\"click\", (e) => {\n      e.stopPropagation();\n      let { target } = e;\n      let value = target.dataset.value;\n      titleElement.innerHTML = value;\n      element.setAttribute(\"data-value\", value);\n      chosenDrop.removeClass(\"active\");\n      this.change(index, data, value);\n    });\n  }\n\n  setField(element, value, data, lastField) {\n    this.initField(element, data, lastField);\n    element.setAttribute(\"data-value\", value);\n    element.querySelector(\".js-title\").innerHTML = value.toUpperCase();\n    element.addClass(\"active\");\n  }\n\n  change(index, data, value) {\n    let { field2, field3, buttonSubmit } = this.elms;\n    switch (index) {\n      case \"1\": {\n        let newData = data.find((item) => String(item.name).toLowerCase() == value.toLowerCase())[\"field_2\"];\n\n        this.resetField(field2);\n        this.resetField(field3);\n\n        this.initField(field2, newData);\n        field2.addClass(\"active\");\n        field2.querySelector(\".chosen-drop\").addClass(\"active\");\n        break;\n      }\n      case \"2\": {\n        let newData = data.find((item) => String(item.name).toLowerCase() == value.toLowerCase())[\"field_3\"];\n\n        this.resetField(field3);\n\n        this.initField(field3, newData, true);\n        field3.addClass(\"active\");\n        field3.querySelector(\".chosen-single\").click();\n        break;\n      }\n      case \"3\":\n        // buttonSubmit.click();\n        break;\n    }\n  }\n\n  resetField(element) {\n    let title = element.querySelector(\".js-title\");\n    element.removeClass(\"active\");\n    title.innerHTML = title.dataset.placeholder;\n    element.setAttribute(\"data-value\", \"\");\n    element.querySelector(\".chosen-results\").innerHTMl = \"\";\n  }\n\n  initEventFieldTitle() {\n    let { container } = this.elms;\n\n    container.querySelectorAll(\".chosen-container\").forEach((fieldContainer) => {\n      let filterTitle = fieldContainer.querySelector(\".chosen-single\");\n      let inputSearch = fieldContainer.querySelector(\"input[name='search']\");\n      let fieldResults = fieldContainer.querySelector(\".chosen-results\");\n\n      let target = filterTitle.nextElementSibling;\n      filterTitle.addEvent(\"click\", () => {\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n      });\n\n      document.addEvent(\"click\", (e) => {\n        if (!filterTitle.parentElement.contains(e.target)) {\n          target.removeClass(\"active\");\n        }\n      });\n\n      inputSearch.addEvent(\"input\", () => {\n        let value = inputSearch.value.toLowerCase();\n        fieldResults.children.forEach((item) => {\n          if (item.innerHTML.toLowerCase().includes(value)) {\n            item.style.display = \"block\";\n          } else {\n            item.style.display = \"none\";\n          }\n        });\n      });\n    });\n  }\n\n  getData(urls) {\n    return Promise.all(urls.split(\",\").map((url) => fetch(url, { dataType: \"json\" })));\n  }\n\n  initEventButtonReset() {\n    let { field1, field2, field3, buttonReset } = this.elms;\n\n    buttonReset.addEvent(\"click\", () => {\n      this.resetField(field1);\n      field1.addClass(\"active\");\n      this.resetField(field2);\n      this.resetField(field3);\n      AT.cookie.delete(\"arn-filter\");\n    });\n  }\n\n  initEventButtonSubmit() {\n    let { buttonSubmit, field1, field2, field3 } = this.elms;\n\n    buttonSubmit.addEvent(\"click\", (e) => {\n      let optionValues = this.getOptionValues();\n\n      if (optionValues.filter(Boolean).length < 3) {\n        switch (optionValues.filter(Boolean).length) {\n          case 0:\n            field1.querySelector(\".chosen-drop\").addClass(\"active\");\n            break;\n          case 1:\n            field2.querySelector(\".chosen-drop\").addClass(\"active\");\n            break;\n          case 2:\n            field3.querySelector(\".chosen-drop\").addClass(\"active\");\n            break;\n        }\n        e.stopPropagation();\n        return;\n      }\n\n      let url = this.getFilterUrl(optionValues, buttonSubmit.dataset.filterType);\n      \n      AT.cookie.set(\"arn-filter\", optionValues, 7);\n      window.location.href = url;\n    });\n  }\n\n  getFilterUrl(optionValues, type = 'tag'){\n    if(type == 'tag')\n      return `${theme.routes.collectionsUrl}/${optionValues[this.collectionPosition].convertToSlug()}/${optionValues.map((i) => i.convertToSlug()).filter((i, index) => this.collectionPosition != index).join(\"+\")}`;\n\n    let { container } = this.elms;\n    const config = JSON.parse(container.querySelector('[name=\"filterAttribute\"]').innerHTML);\n\n    let url = [theme.routes.collectionsUrl];\n\n    Object.values(config).forEach((attr, i)=>{\n      const value = attr == 'collections' ? optionValues[i].convertToSlug() : `${attr}=${optionValues[i]}`;\n      url.push(value);\n    })\n    return url.join('&').replace('&', '/').replace('&', '?');\n  }\n  getOptionValues() {\n    let { field1, field2, field3 } = this.elms;\n    return [`${field1.dataset.value}`, `${field2.dataset.value}`, `${field3.dataset.value}`];\n  }\n}\n\nwindow.Filter = Filter;\nconsole.log(\"filter.js loaded\");\n"],
  "mappings": "MAAA,WAAa,CACX,YAAY,EAAW,CACrB,GAAI,GAAW,EAAU,QAAQ,KACjC,KAAK,mBAAqB,CAAC,EAAU,QAAQ,mBAC7C,KAAK,KAAO,CACV,UAAW,EACX,OAAQ,EAAU,cAAc,2CAChC,OAAQ,EAAU,cAAc,2CAChC,OAAQ,EAAU,cAAc,2CAChC,aAAc,EAAU,cAAc,kBACtC,YAAa,EAAU,cAAc,kBAEvC,KAAK,QAAQ,GAAU,KAAK,AAAC,GAAS,CACpC,EAAO,EAAK,KAAK,GACjB,GAAI,GAAa,GAAG,OAAO,IAAI,cAC/B,GAAI,CAAC,CAAC,GAAc,YAAsB,OAAO,CAC/C,GAAI,CAAC,EAAa,EAAa,GAAe,EAC9C,GAAI,CAAC,GAAe,CAAC,GAAe,CAAC,EAAa,CAChD,GAAG,OAAO,OAAO,cACjB,KAAK,UAAU,KAAK,KAAK,OAAQ,GACjC,OAEF,GAAI,GAAoB,EAAK,KAAK,AAAC,GAAS,OAAO,EAAK,MAAM,eAAiB,EAAY,eAC3F,GAAI,CAAC,EAAmB,CACtB,GAAG,OAAO,OAAO,cACjB,KAAK,UAAU,KAAK,KAAK,OAAQ,GACjC,OAEF,GAAI,GAAQ,EAAkB,QAG9B,GADA,EAAoB,EAAM,KAAK,AAAC,GAAS,OAAO,EAAK,MAAM,eAAiB,EAAY,eACpF,CAAC,EAAmB,CACtB,GAAG,OAAO,OAAO,cACjB,KAAK,UAAU,KAAK,KAAK,OAAQ,GACjC,OAEF,GAAI,GAAQ,EAAkB,QAC9B,AAAI,CAAC,CAAC,GAAS,CAAC,CAAC,GAAS,EAAM,KAAK,AAAC,GAAM,OAAO,GAAG,eAAiB,EAAY,eACjF,MAAK,SAAS,KAAK,KAAK,OAAQ,EAAa,GAC7C,KAAK,SAAS,KAAK,KAAK,OAAQ,EAAa,GAC7C,KAAK,SAAS,KAAK,KAAK,OAAQ,EAAa,EAAO,KAEpD,MAAK,UAAU,KAAK,KAAK,OAAQ,GACjC,GAAG,OAAO,OAAO,mBAGnB,MAAK,UAAU,KAAK,KAAK,OAAQ,GAEnC,KAAK,sBACL,KAAK,uBACL,KAAK,0BAIT,UAAU,EAAS,EAAM,EAAW,CAClC,GAAI,GAAU,EAAY,EAAO,EAAK,IAAI,AAAC,GAAS,EAAK,MACrD,EAAQ,EAAQ,QAAQ,WACxB,EAAe,EAAQ,cAAc,aAErC,EAAgB,EAAQ,cAAc,mBACtC,EAAa,EAAQ,cAAc,gBACvC,EAAc,UAAY,GAC1B,EAAQ,QAAQ,AAAC,GAAS,CACxB,GAAI,GAAK,SAAS,cAAc,MAChC,EAAG,SAAS,iBACZ,EAAG,UAAY,OAAO,GAAM,cAC5B,EAAG,aAAa,aAAc,GAC9B,EAAc,OAAO,KAGvB,EAAc,SAAS,UAAU,QAAS,AAAC,GAAM,CAC/C,EAAE,kBACF,GAAI,CAAE,UAAW,EACb,EAAQ,EAAO,QAAQ,MAC3B,EAAa,UAAY,EACzB,EAAQ,aAAa,aAAc,GACnC,EAAW,YAAY,UACvB,KAAK,OAAO,EAAO,EAAM,KAI7B,SAAS,EAAS,EAAO,EAAM,EAAW,CACxC,KAAK,UAAU,EAAS,EAAM,GAC9B,EAAQ,aAAa,aAAc,GACnC,EAAQ,cAAc,aAAa,UAAY,EAAM,cACrD,EAAQ,SAAS,UAGnB,OAAO,EAAO,EAAM,EAAO,CACzB,GAAI,CAAE,SAAQ,SAAQ,gBAAiB,KAAK,KAC5C,OAAQ,OACD,IAAK,CACR,GAAI,GAAU,EAAK,KAAK,AAAC,GAAS,OAAO,EAAK,MAAM,eAAiB,EAAM,eAAe,QAE1F,KAAK,WAAW,GAChB,KAAK,WAAW,GAEhB,KAAK,UAAU,EAAQ,GACvB,EAAO,SAAS,UAChB,EAAO,cAAc,gBAAgB,SAAS,UAC9C,UAEG,IAAK,CACR,GAAI,GAAU,EAAK,KAAK,AAAC,GAAS,OAAO,EAAK,MAAM,eAAiB,EAAM,eAAe,QAE1F,KAAK,WAAW,GAEhB,KAAK,UAAU,EAAQ,EAAS,IAChC,EAAO,SAAS,UAChB,EAAO,cAAc,kBAAkB,QACvC,UAEG,IAEH,OAIN,WAAW,EAAS,CAClB,GAAI,GAAQ,EAAQ,cAAc,aAClC,EAAQ,YAAY,UACpB,EAAM,UAAY,EAAM,QAAQ,YAChC,EAAQ,aAAa,aAAc,IACnC,EAAQ,cAAc,mBAAmB,UAAY,GAGvD,qBAAsB,CACpB,GAAI,CAAE,aAAc,KAAK,KAEzB,EAAU,iBAAiB,qBAAqB,QAAQ,AAAC,GAAmB,CAC1E,GAAI,GAAc,EAAe,cAAc,kBAC3C,EAAc,EAAe,cAAc,wBAC3C,EAAe,EAAe,cAAc,mBAE5C,EAAS,EAAY,mBACzB,EAAY,SAAS,QAAS,IAAM,CAClC,AAAI,EAAO,SAAS,UAClB,EAAO,YAAY,UAEnB,EAAO,SAAS,YAIpB,SAAS,SAAS,QAAS,AAAC,GAAM,CAChC,AAAK,EAAY,cAAc,SAAS,EAAE,SACxC,EAAO,YAAY,YAIvB,EAAY,SAAS,QAAS,IAAM,CAClC,GAAI,GAAQ,EAAY,MAAM,cAC9B,EAAa,SAAS,QAAQ,AAAC,GAAS,CACtC,AAAI,EAAK,UAAU,cAAc,SAAS,GACxC,EAAK,MAAM,QAAU,QAErB,EAAK,MAAM,QAAU,aAO/B,QAAQ,EAAM,CACZ,MAAO,SAAQ,IAAI,EAAK,MAAM,KAAK,IAAI,AAAC,GAAQ,MAAM,EAAK,CAAE,SAAU,WAGzE,sBAAuB,CACrB,GAAI,CAAE,SAAQ,SAAQ,SAAQ,eAAgB,KAAK,KAEnD,EAAY,SAAS,QAAS,IAAM,CAClC,KAAK,WAAW,GAChB,EAAO,SAAS,UAChB,KAAK,WAAW,GAChB,KAAK,WAAW,GAChB,GAAG,OAAO,OAAO,gBAIrB,uBAAwB,CACtB,GAAI,CAAE,eAAc,SAAQ,SAAQ,UAAW,KAAK,KAEpD,EAAa,SAAS,QAAS,AAAC,GAAM,CACpC,GAAI,GAAe,KAAK,kBAExB,GAAI,EAAa,OAAO,SAAS,OAAS,EAAG,CAC3C,OAAQ,EAAa,OAAO,SAAS,YAC9B,GACH,EAAO,cAAc,gBAAgB,SAAS,UAC9C,UACG,GACH,EAAO,cAAc,gBAAgB,SAAS,UAC9C,UACG,GACH,EAAO,cAAc,gBAAgB,SAAS,UAC9C,MAEJ,EAAE,kBACF,OAGF,GAAI,GAAM,KAAK,aAAa,EAAc,EAAa,QAAQ,YAE/D,GAAG,OAAO,IAAI,aAAc,EAAc,GAC1C,OAAO,SAAS,KAAO,IAI3B,aAAa,EAAc,EAAO,MAAM,CACtC,GAAG,GAAQ,MACT,MAAO,GAAG,MAAM,OAAO,kBAAkB,EAAa,KAAK,oBAAoB,mBAAmB,EAAa,IAAI,AAAC,GAAM,EAAE,iBAAiB,OAAO,CAAC,EAAG,IAAU,KAAK,oBAAsB,GAAO,KAAK,OAE3M,GAAI,CAAE,aAAc,KAAK,KACnB,EAAS,KAAK,MAAM,EAAU,cAAc,4BAA4B,WAE1E,EAAM,CAAC,MAAM,OAAO,gBAExB,cAAO,OAAO,GAAQ,QAAQ,CAAC,EAAM,IAAI,CACvC,GAAM,GAAQ,GAAQ,cAAgB,EAAa,GAAG,gBAAkB,GAAG,KAAQ,EAAa,KAChG,EAAI,KAAK,KAEJ,EAAI,KAAK,KAAK,QAAQ,IAAK,KAAK,QAAQ,IAAK,KAEtD,iBAAkB,CAChB,GAAI,CAAE,SAAQ,SAAQ,UAAW,KAAK,KACtC,MAAO,CAAC,GAAG,EAAO,QAAQ,QAAS,GAAG,EAAO,QAAQ,QAAS,GAAG,EAAO,QAAQ,WAIpF,OAAO,OAAS,EAChB,QAAQ,IAAI",
  "names": []
}
